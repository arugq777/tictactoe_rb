<html>
  <head>
    <title>tictactoe</title>
    <script type="text/javascript" src="./js/jquery-2.0.3.min.js"></script>
    <script type="text/javascript">

      var spacesClickable = true;
      var gameOver = false;

      function setBoardDimensions(){
        $(".board").width($(".board").height());
      }
      
      function setSpaceDimensions(){
        for(i=1; i <= 9; i++){
          $("#"+i).height($(".board").height()/3);
          $("#"+i).width($(".board").height()/3);
        }
      }

      function markSpace(number, mark){
        $("#"+number).append(
          "<img class='mark' src='./img/" + mark + ".svg'></img>"
        );
      }

      function gameOver(){
        gameOver = true;
        spacesClickable = false;
      }

      function isGameOver(){
        return gameOver;
      }

      function getUserMove(move){
        if(isGameOver() == false){
          $.get( "/"+ move, function( data ) {
            console.log(data);
            if(data.valid == true){
              markSpace(data.space, "o");
              updateInfo(data.output);
              if (data.game_over == true){
                gameOver();
              } else {
                getAIMove();
              }
            } else {
              $( "#info" ).append( "<li>" + data.error +"</li>");
              }
          }, "json" );
        }
      }

      function getAIMove(){
        if(isGameOver() == false){
          $.get( "/ai", function( data ) {
            if(data.valid == true){
              markSpace(data.space, "x");
              updateInfo(data.output);
              if (data.game_over == true){
                game_over();
              }
            } else {
              $( "#info" ).append( "<li>" + data.error +"</li>");
            }
          }, "json" );
        }
      }

      function updateInfo(info){
        console.log("update:" + info);
        for(i=0; i < info.length; i++){
          $("#info").append("<li>" + info[i] + "</li>");
        }
      }

      function coinToss(){
        $.get( "/coin_toss", function( data ) {
            updateInfo(data.output);
            if( data.player === "X"){
              getAIMove();
            }
        }, "json" );
      }

      $(document).ready( function(){
        setBoardDimensions();
        setSpaceDimensions();
        $(".space").click( function(){
          //alert($(this).attr('id'));
          if(spacesClickable == true){
            getUserMove($( this ).attr('id')); 
          }
        });
        coinToss();
      });

      $(window).resize( function(){
        setBoardDimensions();
        setSpaceDimensions();
      });

      $( document ).ajaxStart(function() {
        $( "#loading" ).show();
        spacesClickable = false;
      });

      $( document ).ajaxStop(function() {
        $( "#loading" ).hide();
        spacesClickable = true;
      });


    </script>
    <style type="text/css">
      html, body, table, section, tbody, td, tr{
        padding: 0;
        margin:  0;
        border:  0;
      }
      .board { 
        padding-bottom: 0px;
        margin:  0;
        border:  0;
        height: 100%;
        background: url(img/board.svg) no-repeat fixed;
        background-size: contain;
      }

      table tr td img{
        padding: 0;
        margin:  0;
        border:  0;
        display:block;
        margin-left:auto;
        margin-right:auto;
      }

      .mark{
        padding: 0;
        border: 0;
        margin: 0 auto;
        height:70%;
        width:70%;
      }

      aside{
        float:right;
      }

    </style>
  </head>
  <body>
    <header>
    </header>
    <aside>
      <div id="loading">
        Please wait....
      </div>
      <ul id="info">
      </ul>
    </aside>
    <section class="board">
      <table>
        <tr id="row1">
          <td class="space" id="1"></td>
          <td class="space" id="2"></td>
          <td class="space" id="3"></td>
        </tr>
        <tr id="row2">
          <td class="space" id="4"></td>
          <td class="space" id="5"></td>
          <td class="space" id="6"></td>
        </tr>
        <tr id="row3">
          <td class="space" id="7"></td>
          <td class="space" id="8"></td>
          <td class="space" id="9"></td>
        </tr>
      </table>
    </section>
    <footer>
    </footer>
  </body>
</html>